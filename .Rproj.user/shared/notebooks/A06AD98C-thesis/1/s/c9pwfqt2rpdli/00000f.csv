"0","sp <- read.csv(""data/SP500.csv"")"
"0","sp <- sp |> filter(SP500 != ""."") |>"
"0","  mutate(trading_day = row_number(), SP500 = as.numeric(SP500)) |> "
"0","  as_tsibble(index=trading_day, regular=TRUE)"
"0","T <- nrow(sp)"
"0","train <- sp |> filter(trading_day <= floor(nrow(sp)*.6)) |> mutate(log = log(SP500))"
"0","R <- nrow(train)"
"0","test <- sp |> filter(trading_day > floor(nrow(sp)*.6)) |> mutate(log = log(SP500))"
"0","P <- nrow(test)"
"0",""
"0","fit_1 <- train |> model(ARIMA(log(SP500)))"
"0","fit_1_coef <- coef(fit_1) |> select(term, estimate)"
"0","resid_1 <- numeric(P+1) |> as.numeric()"
"0","resid_1[1] <- residuals(fit_1) |> as_tibble() |> select(.resid) |> tail(1)"
"0","resid_1[2] <- test[1,4] - (fit_1_coef[3,2] + (1+fit_1_coef[1,2])*train[R,4] - fit_1_coef[1,2]*train[R-1,4] + fit_1_coef[2,2]*resid_1[1])"
"0","resid_1[3] <- test[2,4] - (fit_1_coef[3,2] + (1+fit_1_coef[1,2])*test[1,4] - fit_1_coef[1,2]*train[R,4] + fit_1_coef[2,2]*resid_1[2])"
"0","for (j in 4:(P+1)) {"
"0","  resid_1[j] <- test[j-1,4] - (fit_1_coef[3,2] + (1+fit_1_coef[1,2])*test[j-2,4] - fit_1_coef[1,2]*test[j-3,4] + fit_1_coef[2,2]*resid_1[j-1])"
"0","}"
"0","mean_1 <- numeric(P) |> as.numeric()"
"0","mean_1[1] <- fit_1_coef[3,2] + (1+fit_1_coef[1,2])*train[R,4] - fit_1_coef[1,2]*train[R-1,4] + fit_1_coef[2,2]*resid_1[1]"
"0","mean_1[2] <- fit_1_coef[3,2] + (1+fit_1_coef[1,2])*test[1,4] - fit_1_coef[1,2]*train[R,4] + fit_1_coef[2,2]*resid_1[2]"
"0","for (j in 3:P) {"
"0","  mean_1[j] <- fit_1_coef[3,2] + (1+fit_1_coef[1,2])*test[j-1,4] - fit_1_coef[1,2]*test[j-2,4] + fit_1_coef[2,2]*resid_1[j]"
"0","}"
"0","var_1 <- glance(fit_1) |> select(sigma2)"
"0","sd_1 <- sqrt(var_1) |> as.numeric()"
"0","pd_1 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  pd_1[j] <- dlnorm(test[[j,2]], mean_1[[j]], sd_1[[1]])"
"0","}"
"0","LS_1 <- sum(log(pd_1)) / P"
"0","LS_1"
"1","[1]"
"1"," -5.864283"
"1","
"
"0","fit_2 <- train |> model(ETS(SP500))"
"0","fit_2_coef <- coef(fit_2) |> select(term, estimate)"
"0","resid_2 <- residuals(fit_2) |> as_tibble() |> select(.resid)"
"0","level <- numeric(T+1) |> as.numeric()"
"0","level[1] <- fit_2_coef[2,2]"
"0","for (j in 1:R) {"
"0","  level[j+1] <- level[j]*(1 + fit_2_coef[1,2]*resid_2[j,1])"
"0","}"
"0","resid_2_new <- numeric(P) |> as.numeric()"
"0","for(i in 1:P) {"
"0","  resid_2_new[i] <- (test[i,2] - level[R+i]) / level[R+i]"
"0","  level[R+i+1] <- level[R+i]*(1 + fit_2_coef[1,2]*resid_2_new[i])"
"0","}"
"0","mean_2 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  mean_2[j] <- level[[R+j]]"
"0","}"
"0","mean_2 <- as_tibble(mean_2)"
"0","var_2 <- glance(fit_2) |> select(sigma2) |> as.numeric()"
"0","var_2 <- mean_2^2*var_2"
"0","sd_2 <- sqrt(var_2)"
"0","pd_2 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  pd_2[j] <- dnorm(test[[j,2]], mean_2[[j,1]], sd_2[[j,1]])"
"0","}"
"0","LS_2 <- sum(log(pd_2)) / P"
"0","LS_2"
"1","[1]"
"1"," -5.837271"
"1","
"
"0","fit_3 <- train |> model(ETS(SP500 ~ error(""M"") + trend(""A"") + season(""N"")))"
"0","fit_3_coef <- coef(fit_3) |> select(term, estimate)"
"0","resid_3 <- residuals(fit_3) |> as_tibble() |> select(.resid)"
"0","level <- numeric(T+1) |> as.numeric()"
"0","level[1] <- fit_3_coef[3,2] # l_0"
"0","trend <- numeric(T+1) |> as.numeric()"
"0","trend[1] <- fit_3_coef[4,2] # b_0"
"0","for (j in 1:R) {"
"0","  level[j+1] <- (level[[j]] + trend[[j]])*(1 + fit_3_coef[1,2]*resid_3[j,1])"
"0","  trend[j+1] <- trend[[j]] + fit_3_coef[1,2]*fit_3_coef[2,2]*(level[[j]] + trend[[j]])*resid_3[j,1]"
"0","}"
"0","resid_3_new <- numeric(P) |> as.numeric()"
"0","for(i in 1:P) {"
"0","  resid_3_new[i] <- (test[i,2] - (level[[R+i]] + trend[[R+i]])) / ((level[[R+i]] + trend[[R+i]]))"
"0","  level[R+i+1] <- (level[[R+i]] + trend[[R+i]])*(1 + fit_3_coef[1,2]*resid_3_new[i])"
"0","  trend[R+i+1] <- trend[[R+i]] + fit_3_coef[1,2]*fit_3_coef[2,2]*(level[[R+i]] + trend[[R+i]])*resid_3_new[i]  "
"0","}"
"0","mean_3 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  mean_3[j] <- level[[R+j]] + trend[[R+j]]"
"0","}"
"0","mean_3 <- as_tibble(mean_3)"
"0","var_3 <- glance(fit_3) |> select(sigma2) |> as.numeric()"
"0","var_3 <- mean_3^2*var_3"
"0","sd_3 <- sqrt(var_3)"
"0","pd_3 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  pd_3[j] <- dnorm(test[[j,2]], mean_3[[j,1]], sd_3[[j,1]])"
"0","}"
"0","LS_3 <- sum(log(pd_3)) / P"
"0","LS_3"
"1","[1]"
"1"," -5.835116"
"1","
"
"0","fit_4 <- train |> model(ARIMA(SP500 ~ trend()))"
"0","fit_4_coef <- coef(fit_4) |> select(term, estimate)"
"0","mean_4 <- numeric(P) |> as.numeric()"
"0","mean_4[1] <- (fit_4_coef[3,2] - fit_4_coef[1,2]*fit_4_coef[3,2] + fit_4_coef[1,2]*fit_4_coef[2,2] + fit_4_coef[1,2]*train[R,2] + (fit_4_coef[2,2] - fit_4_coef[1,2]*fit_4_coef[2,2])*(R+1))"
"0","for (j in 2:P) {"
"0","  mean_4[j] <- (fit_4_coef[3,2] - fit_4_coef[1,2]*fit_4_coef[3,2] + fit_4_coef[1,2]*fit_4_coef[2,2] + fit_4_coef[1,2]*test[j-1,2] + (fit_4_coef[2,2] - fit_4_coef[1,2]*fit_4_coef[2,2])*(R+j))"
"0","}"
"0","var_4 <- glance(fit_4) |> select(sigma2)"
"0","sd_4 <- sqrt(var_4) |> as.numeric()"
"0","pd_4 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  pd_4[j] <- dnorm(test[[j,2]], mean_4[[j]], sd_4[[1]])"
"0","}"
"0","LS_4 <- sum(log(pd_4)) / P"
"0","LS_4"
"1","[1]"
"1"," -7.472367"
"1","
"
"0","fit_5 <- train |> model(ARIMA(log(SP500) ~ trend()))"
"0","fit_5_coef <- coef(fit_5) |> select(term, estimate)"
"0","mean_5 <- numeric(P) |> as.numeric()"
"0","mean_5[1] <- (fit_5_coef[3,2] - fit_5_coef[1,2]*fit_5_coef[3,2] + fit_5_coef[1,2]*fit_5_coef[2,2] + fit_5_coef[1,2]*train[R,4] + (fit_5_coef[2,2] - fit_5_coef[1,2]*fit_5_coef[2,2])*(R+1))"
"0","for (j in 2:P) {"
"0","  mean_5[j] <- (fit_5_coef[3,2] - fit_5_coef[1,2]*fit_5_coef[3,2] + fit_5_coef[1,2]*fit_5_coef[2,2] + fit_5_coef[1,2]*test[j-1,4] + (fit_5_coef[2,2] - fit_5_coef[1,2]*fit_5_coef[2,2])*(R+j))"
"0","}"
"0","var_5 <- glance(fit_5) |> select(sigma2)"
"0","sd_5 <- sqrt(var_5) |> as.numeric()"
"0","pd_5 <- numeric(P) |> as.numeric()"
"0","for (j in 1:P) {"
"0","  pd_5[j] <- dlnorm(test[[j,2]], mean_5[[j]], sd_5[[1]])"
"0","}"
"0","LS_5 <- sum(log(pd_5)) / P"
"0","LS_5"
"1","[1]"
"1"," -5.871551"
"1","
"
