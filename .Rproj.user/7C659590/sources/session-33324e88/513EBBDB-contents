---
knit: "bookdown::render_book"
---

\appendix

# Appendix  

```{r, echo=FALSE, eval=FALSE}
citation("tidyverse")
citation("dplyr")
citation("fpp3")
version$version.string
```


The S&P500 returns dataset has a total of 2519 ($T$) observations and is partitioned into two periods with a rough proportion. The in-sample period contains the first 60% of the data ($R = 1511$), which is used for estimating unknown parameters in each model. The remaining 40% ($P = 1008$) becomes the out-of-sample period for further evaluation.  

The following prediction models are used to study the performance of two-model pools: 

1. Model 1: An ARIMA(1,1,1) model with an intercept for the natural logarithm of S&P 500. 
2. Model 2: An ETS(M,N,N) model for the S&P 500. 
3. Model 3: An ETS(M,A,N) model for the S&P 500. 

All error terms are assumed to be independent and normally distributed with mean zero and variance $\sigma_j^2 \ \text{for}\  j = 1,2,3$.

4. Model 4: A linear regression model for the S&P 500 with a trend regressor and errors, follow an ARIMA(1,0,0) process. 
5. Model 5: A linear regression model for the natural logarithm of S&P 500 with a trend regressor and errors follow an ARIMA(1,0,0) process. 

Both error terms in the ARIMA model are assumed to be independent and normally distributed with mean zero and variance $\sigma_j^2 \ \text{for}\  j = 4,5$.


Exact formulas and explanations of these models can be found in @fpp3. The formula of the conditional variance for the ETS models in this case is discussed in Chapter 6.3 of @HKOS08. All coding is performed using R Statistical Software (version 4.2.1 (2022-06-23)). The packages used are `tidyverse` [@tidy19], `dplyr` [@dplyr23], and `fpp3` [@fpp23].


All unknown parameters are estimated by maximizing the likelihood function using the in-sample period data. Once the estimated are obtained, they are held fixed for the density evaluation. For each model, we generate the predictive densities at every future time point of S&P 500 returns ($h=1,2,...,P$) given that all past information is known. In order to make a comparison between models, the log of S&P 500 returns will be evaluated by the log normal density function.


The log predictive score of each model is calculated and presented in Table \ref{tab:1}. If only one model can be chosen, the model with the highest score will be preferred, which is the ETS(M,A,N) model with a score of -5881.7970 in this case.


\vspace{0.3cm}


\begin{table}[htbp!]
\centering
\caption{Log predictive score of each proposed model for S\&P 500 returns.}
\begin{tabular}{l*{4}{c}}
\hline
     ARIMA(1,1,1) & ETS(M,N,N) & ETS(M,A,N) & LM (linear) & LM (log) \\
    \hline
     -5911.1974 & -5883.9697  & -5881.7970 & -7532.1464 & -5918.5230\\
    \hline
\end{tabular}
\label{tab:1}
\end{table}

The top 4 combinations and their log scores are collected in Table \ref{tab:3}.

\begin{table}[ht]
  \centering
  \caption{The top four density forecasts combinations evaluated by the log predictive score}
    \begin{tabular}{ll}
    \toprule
    Combination & Log predictive score \\
    \midrule
    ARIMA(1,1,1) \& ETS(M,N,N) & -5839.3045 \\
    ARIMA(1,1,1) \& ETS(M,A,N) & -5842.7634 \\
    ETS(M,N,N) \&  LM (log) & -5858.6397 \\
    ETS(M,A,N) \&  LM (log) & -5859.7980 \\
    \bottomrule
    \end{tabular}
  \label{tab:3}
\end{table}




